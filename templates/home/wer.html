<html>

<head>
    <title>Inventory Optimization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            transform: scale(1);
        }

        .sidebar {
            background-color: #ffffff;
            padding: 20px;
            height: 100vh;
            border-right: 1px solid #dee2e6;
        }

        .content {
            padding: 20px;
        }

        /* Progress Bar Container */
        #progress-container {
            display: none; /* Initially hidden */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1001;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress {
            width: 80%; /* Adjust width as needed */
            height: 20px;
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <div class="sidebar">
            <!-- Sidebar content -->
        </div>
        <div class="content flex-grow-1">
            <!-- Progress bar container -->
            <div id="progress-container">
                <div class="progress">
                    <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <!-- Message display -->
            <div id="message" class="alert alert-success" style="display: none; margin-top: 20px;"></div>

            <!-- Other content -->
            <div class="header">
                <h1>Inventory Optimizer and Sales Booster</h1>
                <input type="text" class="form-control search-bar" placeholder="Search for...">
            </div>
            <!-- Other cards and content -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#update-button').click(function (event) {
                event.preventDefault(); // Prevent default behavior
                $('#progress-container').show(); // Show the progress bar
                $('#message').hide(); // Hide any previous messages
                $('#progress-bar').css('width', '0%').attr('aria-valuenow', 0); // Reset progress bar

                // Simulate progress
                let progress = 0;
                const interval = setInterval(function () {
                    if (progress >= 100) {
                        clearInterval(interval);
                    } else {
                        progress += 10; // Increment progress
                        $('#progress-bar').css('width', progress + '%').attr('aria-valuenow', progress);
                    }
                }, 1000); // Update every second

                // Make AJAX request to update tables and graphs
                $.ajax({
                    url: '/update_tables_graphs',
                    type: 'POST',
                    success: function (response) {
                        clearInterval(interval); // Stop the progress simulation
                        $('#progress-bar').css('width', '100%').attr('aria-valuenow', 100); // Complete the progress bar
                        $('#message').text(response.message).show(); // Show success message
                        setTimeout(function () {
                            window.location.href = '/'; // Redirect to home page after 3 seconds
                        }, 3000);
                    },
                    error: function () {
                        clearInterval(interval); // Stop the progress simulation
                        $('#message').text('An error occurred while updating.').show(); // Show error message
                    }
                });
            });
        });
    </script>
</body>

</html>